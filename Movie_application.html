<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta charset="utf-8">
    <meta name="creator" content="Gilmore & Harris">
    <meta name="subject" content="Fetch, API">
    <meta name="description" content=" Building a single page movie application (SPA). with a glitch api ">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Personal StyleSheet -->
    <link type="text/css" href="css/Movie_application.css" rel="stylesheet">
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <title>Movie Palace</title>
    <!-- Favicon -->
    <link rel="icon" href="/img/vhs.png">

</head>
<body>

<header class="bg-light shadow">
    <h1> Movie Palace</h1>
</header>

<form id="movie-form" class="border w-50 mx-auto bg-light shadow p-3">
    <div class="form-group">
        <label  class="border p-2 mx-auto" for="movieTitle">Title</label>
        <input type="text" class="form-control" id="movieTitle"  required>
    </div>
    <div class="form-group">
        <label for="ratingMovie">Rating</label>
        <input type="number" class="form-control" id="ratingMovie">
    </div>
    <div class="form-group">
        <label for="yearMovie">Year</label>
        <input type="number" class="form-control" id="yearMovie">
    </div>
    <div class="form-group">
        <label for="genreMovie">Genre</label>
        <input type="text" class="form-control" id="genreMovie">
    </div>
    <div class="form-group">
        <label for="directorMovie">Director</label>
        <input type="text" class="form-control" id="directorMovie">
    </div>
    <button type="submit" id="submitButton"  class="btn btn-primary mt-3">Submit</button>
    <button type="submit" id="saveButton" class="btn btn-warning d-none mt-3">Save</button>
</form>



    <div id='post' class="d-flex overflow-auto py-5"></div>


<script>
    //--- Special Variables
    const URL = 'https://cuboid-standing-scribe.glitch.me/movies';


    // Creates each post of every movie in the JSON
    const outPutMovie = '';
    const renderPost = (posts) => {posts.forEach(movie => {
        outputMovie = `<section class="bg-dark text-white m-3 p-3 h-fit-content" d id="mainContainer">
                    <img src="${movie.poster}" class="rounded">\
                        <h4 class="pt-3 text-capitalize movieTitle">${movie.title}</h4>
                        <p class="p-0 m-0 movie-header year">${movie.year}</p>
                        <p class="p-0 m-0 rating">${movie.rating} Stars</p>
                        <p class="p-0 m-0 genre">${movie.genre}</p>
                        <p class="p-0 m-0 director">${movie.director}</p>
                        <button  class="btn btn-primary" data-id=${movie.id} id="edit-post">Edit</button>
                        <button class="btn btn-secondary" data-id=${movie.id}  id="delete-post">Delete</button>
            </section>`
        $('#post').append(outputMovie);
    })}

    //--- READ ----
    fetch(URL)
        .then(response => response.json())
        .then(data => renderPost(data))


    //--Create Insert new post with a click of the submit button
    const submitButton = $('#submitButton')
    submitButton.click((e)=>{
        e.preventDefault();
        alert('Thank you for your response! We will be adding your movie to your list')
        const titleInput = $('#movieTitle').val();
        const yearInput = $('#yearMovie').val();
        const ratingInput = $('#ratingMovie').val();
        const genreInput = $('#genreMovie').val();
        const directorInput = $('#directorMovie').val();
        fetch(URL, {
            method:'POST',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify({
                title: titleInput,
                rating: ratingInput,
                year: yearInput,
                genre: genreInput,
                director: directorInput
            })
        }).then( response => response.json())
            .then( movie => {
                $('#post').append(
                    `<section class='bg-dark text-white m-3 p-3 h-fit-content' id="mainContainer">
                        <img src="${movie.poster}" class="rounded">
                        <section class="">
                        <h4 class='pt-3 text-capitalize'>${movie.title}</h4>
                        <p class='p-0 m-0'>${movie.year}</p>
                        <p class='p-0 m-0'>${movie.rating} Stars</p>
                        <p class='p-0 m-0'>${movie.genre}</p>
                        <p class='p-0 m-0'>${movie.director}</p>
                        <button id="edit" class="btn btn-primary">Edit</button>
                        <button id="save" class="btn btn-warning d-none">Save</button>
                        <button id="delete" class="btn btn-secondary">Delete</button>
                    </section>`
                )
            })
    })

    // //--Delete
    $('#post').click((e)=>{
        console.log(e);
        var targetID = e.target.dataset.id
        let editButtonIsPressed = e.target.id == 'edit-post'
        let delButtonIsPressed = e.target.id == 'delete-post'

        // Remove Existing Post
        if(delButtonIsPressed){
            console.log('Remove Post');
            fetch(`${URL}/${targetID}`, {
                method: 'DELETE',
            })
                .then(response => response.json())
                .then(data => location.reload())
        }
        // Edit Existing Post
        if(editButtonIsPressed) {
            $('#saveButton').removeClass('d-none');
            submitButton.addClass('d-none');
            // console.log('Edit Post');
            let parent = e.target.parentElement;
            // console.log(parent)
            const TitleContent = parent.querySelector('.movieTitle').textContent;
            const YearContent = parent.querySelector('.year').textContent;
            const RatingContent = parent.querySelector('.rating').textContent;
            const GenreContent = parent.querySelector('.genre').textContent;
            const directorContent = parent.querySelector('.director').textContent;

            console.log(TitleContent);
            console.log(YearContent);
            console.log(RatingContent);
            console.log(GenreContent);
            console.log(directorContent);

         let movietitleValue  = $('#movieTitle');
         let ratingValue  = $('#ratingMovie');
         let yearValue  =  $('#yearMovie');
         let genreValue  =  $('#genreMovie');
         let directorValue  =   $('#directorMovie');

            movietitleValue.value = TitleContent
            ratingValue.value = YearContent
            yearValue.value = RatingContent
            genreValue.value = GenreContent
            directorValue.value = directorContent


            $('#saveButton').click((e)=>{
                console.log('yay!')
                submitButton.removeClass('d-none');
                $('#saveButton').addClass('d-none');
            })
        }
    })





</script>
</body>
<!-- Boostrap JS ----->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</html>