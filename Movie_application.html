<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta charset="utf-8">
    <meta name="creator" content="Gilmore & Harris">
    <meta name="subject" content="Fetch, API">
    <meta name="description" content=" Building a single page movie application (SPA). with a glitch api ">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Personal StyleSheet -->
    <link type="text/css" href="css/Movie_application.css" rel="stylesheet">
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <title>Movie Palace</title>
    <!-- Favicon -->
    <link rel="icon" href="/img/vhs.png">

</head>
<body>

<header class="bg-light shadow">
    <h1> Movie Palace</h1>
</header>

<form id="movie-form" class="border w-50 mx-auto bg-light shadow p-3" action="#" method="get">
    <div class="form-group">
        <label  class="border p-2 mx-auto" for="movieTitle">Title</label>
        <input type="text" class="form-control" id="movieTitle" aria-describedby="movieTitle"
               placeholder="Enter Movie Title" required>
        <label for="ratingMovie">Rating</label>
        <input type="text" class="form-control" id="ratingMovie" placeholder="Rating">

        <label for="yearMovie">Year</label>
        <input type="text" class="form-control" id="yearMovie" placeholder="Year">
        <label for="genreMovie">Genre</label>
        <input type="text" class="form-control" id="genreMovie" placeholder="Genre">
        <label for="directorMovie">Director</label>
        <input type="text" class="form-control" id="directorMovie" placeholder="Director">
    </div>
    <button type="submit" class="btn btn-primary mt-3">Submit</button>
</form>



    <div id='post' class="d-flex overflow-auto py-5"></div>


</body>
<!-- Boostrap JS ----->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script>

    //----- CRUD Fetch
    //--- Special Variables
    const URL = 'https://cuboid-standing-scribe.glitch.me/movies';
    //--- READ ----
    fetch(URL)
        .then( response => {
            response.json()
                .then(movies => {
//Going to run through each movie
                    movies.forEach(movie => {
//The Container for each movie
                        $('#post').append(
                            `<section class='bg-dark text-white m-3 p-3 h-fit-content' id="mainContainer">
                            <img src="${movie.poster}" class="rounded">
                            <section class="">
                            <h4 class='pt-3 text-capitalize'>${movie.title}</h4>
                            <p class='p-0 m-0'>${movie.year}</p>
                            <p class='p-0 m-0'>${movie.rating} Stars</p>
                            <p class='p-0 m-0'>${movie.genre}</p>
                            <p class='p-0 m-0'>${movie.director}</p>
                            <button id="edit" class="btn btn-primary">Edit</button>
                            <button id="save" class="btn btn-warning d-none">Save</button>
                            <button id="delete" class="btn btn-secondary">Delete</button>
                        </section>`
                        )
                    })
                })
        })
    //--- CREATE ----
    function create(){
        //----- This is going to add the content to the list and update it live
        $('[type="submit"]').click((e)=>{
            e.preventDefault();
            console.log(e.target);

            const titleInput = $('#movieTitle').val();
            const yearInput = $('#yearMovie').val();
            const ratingInput = $('#ratingMovie').val();
            const genreInput = $('#genreMovie').val();
            const directorInput = $('#directorMovie').val();

            fetch(URL,{
                method:'POST',
                body: JSON.stringify({
                    title:titleInput,
                    rating:ratingInput,
                    year:yearInput,
                    genre:genreInput,
                    director:directorInput
                }),
                headers:{
                    'Content-Type': 'application/json'
                }
            }).then( response => response.json())
                .then( movie => {
                    $('#post').append(
                        `<section class='bg-dark text-white m-3 p-3 h-fit-content' id="mainContainer">
                        <img src="${movie.poster}" class="rounded">
                        <section class="">
                        <h4 class='pt-3 text-capitalize'>${movie.title}</h4>
                        <p class='p-0 m-0'>${movie.year}</p>
                        <p class='p-0 m-0'>${movie.rating} Stars</p>
                        <p class='p-0 m-0'>${movie.genre}</p>
                        <p class='p-0 m-0'>${movie.director}</p>
                        <button id="edit" class="btn btn-primary">Edit</button>
                        <button id="save" class="btn btn-warning D-none">Save</button>
                        <button id="delete" class="btn btn-secondary">Delete</button>
                    </section>`
                    )
                })
        })
    }
    create();


    //----- UPDATE THE INFO

    $('#post').click((e)=>{
        console.log(e);
        if (e.target.id === 'edit') {
            console.log('you pressed edit');
            $(document).find('#edit' ).hide()
            $(document).find('#save').removeClass('d-none')
        }
        //----- UPDATE THE INFO
        else if (e.target.id === 'delete') {
            console.log(e);
            console.log('you pressed delete')
        }
    })

</script>
</html>